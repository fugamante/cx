#!/usr/bin/env bash
set -euo pipefail

REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
if [[ -n "${CX_SHELL_RC:-}" ]]; then
  SHELL_RC="${CX_SHELL_RC}"
elif [[ -f "${HOME}/.bash_profile" ]]; then
  SHELL_RC="${HOME}/.bash_profile"
elif [[ -f "${HOME}/.profile" ]]; then
  SHELL_RC="${HOME}/.profile"
else
  SHELL_RC="${HOME}/.bash_profile"
fi
LINE="source \"${REPO_ROOT}/cx.sh\""

if [[ ! -f "$SHELL_RC" ]]; then
  touch "$SHELL_RC"
fi

if grep -Fq "$LINE" "$SHELL_RC"; then
  echo "cx already installed in $SHELL_RC"
else
  {
    echo
    echo "# cx utilities"
    echo "$LINE"
  } >> "$SHELL_RC"
  echo "Installed cx utilities into $SHELL_RC"
fi

echo "Run: source \"$SHELL_RC\""
